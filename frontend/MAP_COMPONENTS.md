# –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∫–∞—Ä—Ç—ã –º–∏—Ä–∞ BattleMap

## –û–±–∑–æ—Ä

–°–æ–∑–¥–∞–Ω–∞ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–∞—Ä—Ç—ã –º–∏—Ä–∞ –¥–ª—è –∏–≥—Ä—ã BattleMap —Å —Å–∏—Å—Ç–µ–º–æ–π Fog of War, –∞–Ω–∏–º–∞—Ü–∏—è–º–∏ –∏ —Å–∏—Å—Ç–µ–º–æ–π —á–∞—Å—Ç–∏—Ü.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

- **`/src/components/Map/GameWorldMap.tsx`** - –ì–ª–∞–≤–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–∞—Ä—Ç—ã –º–∏—Ä–∞
- **`/src/components/Map/MapDemo.tsx`** - –î–µ–º–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –£—Ç–∏–ª–∏—Ç—ã

- **`/src/utils/worldData.ts`** - –î–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã –º–∏—Ä–∞ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- **`/src/utils/mapHelpers.ts`** - –ü–æ–º–æ—â–Ω–∏–∫–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–∞—Ä—Ç–æ–π
- **`/src/utils/particleSystem.ts`** - –°–∏—Å—Ç–µ–º–∞ —á–∞—Å—Ç–∏—Ü –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–æ–≤

## –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### üåç –ö–∞—Ä—Ç–∞ –º–∏—Ä–∞
- –†–µ–∞–ª—å–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã —Å—Ç—Ä–∞–Ω (–≥–æ—Ç–æ–≤–∞ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å TopoJSON)
- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –ø–∞–Ω–æ—Ä–∞–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∑—É–º
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –Ω–∞ Canvas
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö –∂–µ—Å—Ç–æ–≤

### üå´Ô∏è Fog of War —Å–∏—Å—Ç–µ–º–∞
- –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–µ—Ä–∞—è/–±–µ–ª–∞—è –∫–∞—Ä—Ç–∞
- –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ –∑–∞–∫—Ä–∞—à–∏–≤–∞–Ω–∏–µ –ø—Ä–∏ —Ç–∞–ø–∞—Ö
- –ü–ª–∞–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏
- –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –æ—Ç 0% –¥–æ 100%

### ‚ú® –ê–Ω–∏–º–∞—Ü–∏–∏ –∏ —ç—Ñ—Ñ–µ–∫—Ç—ã
- Ripple —ç—Ñ—Ñ–µ–∫—Ç –ø—Ä–∏ —Ç–∞–ø–∞—Ö
- –°–∏—Å—Ç–µ–º–∞ —á–∞—Å—Ç–∏—Ü —Å –≤–∑—Ä—ã–≤–∞–º–∏ —Ü–≤–µ—Ç–∞ —Å—Ç—Ä–∞–Ω—ã
- –ü–ª–∞–≤–Ω—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∑–∞–∫—Ä–∞—à–∏–≤–∞–Ω–∏—è
- –ú–µ—Ä—Ü–∞—é—â–∏–µ –∏—Å–∫—Ä—ã –ø—Ä–∏ –∑–∞–≤–æ–µ–≤–∞–Ω–∏–∏

### üöÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- Multi-layer Canvas –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- Throttling –¥–ª—è touch —Å–æ–±—ã—Ç–∏–π
- –°–∏—Å—Ç–µ–º–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### Canvas —Å–ª–æ–∏
1. **Background Canvas** - –°—Ç–∞—Ç–∏—á–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç (—Å—Ç—Ä–∞–Ω—ã, —Ñ–æ–Ω)
2. **Effects Canvas** - –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —ç—Ñ—Ñ–µ–∫—Ç—ã (—á–∞—Å—Ç–∏—Ü—ã, ripples)
3. **Main Canvas** - –ö–æ–º–ø–æ–∑–∏—Ü–∏—è –≤—Å–µ—Ö —Å–ª–æ–µ–≤

### –ú–µ–Ω–µ–¥–∂–µ—Ä—ã
- **`FogOfWarManager`** - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–Ω—ã–º–∏ –æ–±–ª–∞—Å—Ç—è–º–∏
- **`ProgressAnimator`** - –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∑–∞–∫—Ä–∞—à–∏–≤–∞–Ω–∏—è
- **`ParticleSystem`** - –°–∏—Å—Ç–µ–º–∞ —á–∞—Å—Ç–∏—Ü –∏ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
- **`MapTransformHelper`** - –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –û—Å–Ω–æ–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
```tsx
import { GameWorldMap } from './components/Map/GameWorldMap';

function MyApp() {
  return (
    <div className="h-screen">
      <GameWorldMap />
    </div>
  );
}
```

### –î–µ–º–æ —Ä–µ–∂–∏–º
```tsx
import { MapDemo } from './components/Map/MapDemo';

function DemoApp() {
  return <MapDemo />;
}
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞—Ä—Ç—ã (MAP_CONFIG)
```typescript
export const MAP_CONFIG = {
  WIDTH: 1600,           // –®–∏—Ä–∏–Ω–∞ –∫–∞—Ä—Ç—ã
  HEIGHT: 800,           // –í—ã—Å–æ—Ç–∞ –∫–∞—Ä—Ç—ã
  MIN_ZOOM: 0.5,         // –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∑—É–º
  MAX_ZOOM: 8,           // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –∑—É–º
  
  // –ê–Ω–∏–º–∞—Ü–∏–∏
  TAP_ANIMATION_DURATION: 800,     // –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏ —Ç–∞–ø–∞
  PROGRESS_ANIMATION_SPEED: 0.02,  // –°–∫–æ—Ä–æ—Å—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
  PARTICLE_COUNT: 12,              // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å—Ç–∏—Ü
  
  // Fog of War
  FOG_ALPHA: 0.8,               // –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å —Ç—É–º–∞–Ω–∞
  PROGRESS_SEGMENTS: 20,        // –°–µ–≥–º–µ–Ω—Ç—ã –∞–Ω–∏–º–∞—Ü–∏–∏
};
```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å backend

### API –≤—ã–∑–æ–≤—ã
- `gameAPI.placeTap(countryId, x, y)` - –†–∞–∑–º–µ—â–µ–Ω–∏–µ —Ç–∞–ø–∞
- `wsService.sendTap(countryId, x, y)` - WebSocket –æ—Ç–ø—Ä–∞–≤–∫–∞

### Store –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- `useGameStore()` - Zustand store –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## –≠—Ñ—Ñ–µ–∫—Ç—ã

### –°–∏—Å—Ç–µ–º–∞ —á–∞—Å—Ç–∏—Ü
- **–í–∑—Ä—ã–≤ —á–∞—Å—Ç–∏—Ü** –ø—Ä–∏ —Ç–∞–ø–µ
- **–°–ª–µ–¥—ã** –ø—Ä–∏ –¥–≤–∏–∂–µ–Ω–∏–∏
- **–ò—Å–∫—Ä—ã** –ø—Ä–∏ –∑–∞–≤–æ–µ–≤–∞–Ω–∏–∏ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏
- **–≠–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–µ —ç—Ñ—Ñ–µ–∫—Ç—ã**

### –ê–Ω–∏–º–∞—Ü–∏–∏
- **Ripple —ç—Ñ—Ñ–µ–∫—Ç** —Å —Ä–∞—Å—Ö–æ–¥—è—â–∏–º–∏—Å—è –∫—Ä—É–≥–∞–º–∏
- **–ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ –∑–∞–∫—Ä–∞—à–∏–≤–∞–Ω–∏–µ** —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–π
- **–ü–ª–∞–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã** –º–µ–∂–¥—É —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- Canvas rendering —Å multiple layers
- Throttled touch events (16ms)
- Debounced heavy operations
- Constrained transform calculations
- Particle pooling system

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- FPS counter –≤ debug —Ä–µ–∂–∏–º–µ
- Particle count monitoring
- Frame time tracking

## –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### –ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
1. **–†–µ–∞–ª—å–Ω—ã–µ TopoJSON –¥–∞–Ω–Ω—ã–µ** - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Natural Earth
2. **–í–µ–∫—Ç–æ—Ä–Ω—ã–µ —Ç–∞–π–ª—ã** - –î–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
3. **–ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è —á–∞—Å—Ç–∏—Ü** - –ü—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ
4. **–ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ** - –í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
5. **–û—Ñ–ª–∞–π–Ω –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - –î–ª—è —Ä–∞–±–æ—Ç—ã –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- WebGL renderer –¥–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- Worker threads –¥–ª—è —Ç—è–∂–µ–ª—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
- IndexedDB –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
- Service Worker –¥–ª—è –æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–∞

## –û—Ç–ª–∞–¥–∫–∞

### Debug –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- Zoom level –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
- FPS counter
- Particle count
- Touch events logging

### –ö–æ–Ω—Å–æ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
window.gameMap = {
  clearFog: () => fogManager.clear(),
  addParticles: (x, y) => particleSystem.createTapExplosion(x, y, '#ff0000'),
  setProgress: (country, progress) => progressAnimator.setTarget(country, progress)
};
```